ARG PHPPATH=/etc/php/7.4/fpm

# Copy custom PHP-FPM pool configuration
COPY	conf/www.conf ${PHPPATH}/pool.d/

# Configure PHP-FPM for Docker environment:
# Fix path info for security
# Change from socket to TCP port 9000 for container communication
# Set proper listen mode permissions
# Disable daemonization (foreground mode for Docker)
RUN		sed -i 's/;cgi.fix_pathinfo=1/cgi.fix_pathinfo=0/g' ${PHPPATH}/php.ini && \
		sed -i "s/listen = \/run\/php\/php$PHP_VERSION_ENV-fpm.sock/listen = 9000/g" ${PHPPATH}/pool.d/www.conf && \
		sed -i 's/;listen.mode = 0660/listen.mode = 0660/g' ${PHPPATH}/pool.d/www.conf && \
		sed -i 's/;daemonize = yes/daemonize = no/g' ${PHPPATH}/pool.d/www.conf
		


